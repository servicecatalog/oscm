<!-- Copyright FUJITSU LIMITED 2020-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:a4j="http://richfaces.org/a4j"
                xmlns:adm="http://www.fujitsu.com/global/services/software/interstage"
                xmlns:mp="http://www.fujitsu.com/global/services/software/interstage/marketplace"
                xmlns:rich="http://richfaces.org/rich" template="../templates/mainBootstrap.xhtml">

 <ui:define name="pageId">
  <c:set var="pageId" value="marketplace.account.profile"/>
  <c:set var="focusElement" value="salutation"/>
 </ui:define>

 <ui:define name="breadcrumbs">
  <adm:initialize initializingMethod="#{organizationBean.initialize}"/>
  <mp:bootstrapBreadcrumbs>
   <mp:crumb labelPageId="marketplace.account" link="/marketplace/playground/account/index.jsf"/>
   <mp:crumb labelPageId="#{pageId}"/>
  </mp:bootstrapBreadcrumbs>
 </ui:define>

 <ui:define name="contentstitle">
  <a4j:outputPanel layout="block" styleClass="contentstitle indent1col clearfix">
   <br />
  </a4j:outputPanel>
 </ui:define>

 <ui:define name="aside">
  <mp:bootstrapNavigationMenu bean="#{accountNavigationBean}"/>
 </ui:define>

 <ui:define name="contents">
  <h:form id="validateCurrentUserRolesForm">
   <a4j:jsFunction name="validateCurrentUserRoles"
                   data="#{organizationBean.currentUserRolesChanged}"
                   oncomplete="if(event.data==true){#{rich:component('reLogining')}.show();}
                     else{setOnSubmit(true);setDirty(false);
                     #{rich:element('saveButton')}.click();setOnSubmit(false);} return false;">
   </a4j:jsFunction>
  </h:form>

  <a4j:outputPanel id="all" layout="block">
   <div class="con-flow-root">
    <mp:outputStep value="#{msg['marketplace.account.profile.title']}"/>

    <rich:tabPanel id="profileTablePanel" switchType="client" activeItem="#{sessionBean.selectedTab}">
     <rich:tab id="tabUser" header="#{msg['marketplace.account.profile.userTab']}"
               onheaderclick="setSelectedTab('tabUser');"
               rendered="#{empty appBean.hiddenUIElements['organization.edit.userProfile']}">

      <h:form id="userForm">

       <h2>
        <adm:outputStep value="#{msg['organization.edit.userProfile']}"/>
       </h2>

       <a4j:outputPanel layout="block" styleClass="d-inline-block my-3"
                        rendered="#{not organizationBean.currentUser.remoteLdapActive and userBean.internalAuthMode}">
        <adm:buttonCustomizedOnClickBootstrap id="changePwdButton" value="#{msg['button.changePassword']}"
                                              onclick="showLoginPanel('');return false;"
                                              styleClass="btn btn-secondary"/>
       </a4j:outputPanel>
       <mp:pixelline rendered="#{not organizationBean.currentUser.remoteLdapActive and userBean.internalAuthMode}"/>

       <div class="con-width">
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" value="#{msg['user.userId']}"/>
         </div>
         <label id="userID"
                class="col-md-9 col-form-label"><strong>#{organizationBean.currentUser.userId}</strong></label>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" value="#{msg['user.userGroup']}"/>
         </div>
         <label id="userGroup"
                class="col-md-9 col-form-label"><strong>#{organizationBean.currentUser.groupsToDisplay}</strong></label>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" value="#{msg['user.salutation']}"/>
         </div>
         <div class="col-md-9">
          <h:selectOneMenu id="salutation" value="#{organizationBean.currentUser.salutation}"
                           styleClass="custom-select" onchange="setDirty(true)"
                           rendered="#{empty rendered or rendered}">
           <adm:salutationItems/>
          </h:selectOneMenu>
         </div>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" value="#{msg['user.firstName']}"/>
         </div>
         <div class="col-md-9">
          <h:inputText id="firstName" value="#{organizationBean.currentUser.firstName}"
                       disabled="#{organizationBean.currentUser.firstNameDisabled}" styleClass="form-control"
                       rendered="#{not sessionBean.nameSequenceReversed}" maxlength="#{appBean.nameLen}"/>
         </div>
        </div>
        <div class="form-row pb-2">
         <label class="col-md-3 col-form-label">#{msg['user.lastName']}:</label>
         <div class="col-md-9">
          <h:inputText id="lastName" value="#{organizationBean.currentUser.lastName}"
                       disabled="#{organizationBean.currentUser.lastNameDisabled}" maxlength="#{appBean.nameLen}"
                       styleClass="form-control" rendered="#{not sessionBean.nameSequenceReversed}"/>
         </div>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" required="#{true}" value="#{msg['user.email']}"/>
         </div>
         <div class="col-md-9">
          <h:inputText id="email" label="#{msg['user.email']}" required="#{true}" styleClass="form-control"
                       value="#{organizationBean.currentUser.email}" maxlength="#{appBean.nameLen}"
                       disabled="#{organizationBean.currentUser.emailDisabled}" validatorId="email"/>
         </div>
        </div>
        <div class="form-row pb-2">
         <label class="col-md-3 col-form-label">#{msg['user.locale']}:</label>
         <div class="col-md-9">
          <div class="input-group mb-3">
           <h:selectOneMenu id="locale" styleClass="custom-select" value="#{organizationBean.currentUser.locale}"
                            onchange="setDirty(true)" rendered="#{empty rendered or rendered}">
            <adm:localeItems/>
            <f:validator validatorId="SupportedLanguageValidator"/>
           </h:selectOneMenu>
           <div class="input-group-append">
            <a href="#" class="btn btn-secondary" title="#{msg['user.locale']}" data-toggle="popover"
               data-trigger="hover" data-content="#{msg['marketplace.account.editUser.hint.locale']}"
               data-container="body">
             <i class="fa fa-info-circle"/></a>
           </div>
          </div>
         </div>
        </div>
       </div>

       <hr/>
       <adm:buttonPanel layout="block" styleClass="clearfix">
        <adm:buttonBootstrap id="saveUserButton" value="#{msg['button.save']}" bean="#{organizationBean}" action="save"
                             onclick="validateCurrentUserRoles();return false;"
                             styleClass="btn btn-secondary float-right"/>
       </adm:buttonPanel>
      </h:form>
     </rich:tab>

     <rich:tab id="tabOrg" header="#{msg['marketplace.account.profile.organizationTab']}"
               onheaderclick="setSelectedTab('tabOrg');"
               rendered="#{userBean.isOrganizationAdmin and empty appBean.hiddenUIElements['organization.edit.organizationData']}">

      <h:form id="orgForm">

       <h2>
        <adm:outputStep value="#{msg['organization.edit.organizationData']}"/>
       </h2>
       <hr/>

       <div class="con-width">
        <div class="form-row pb-2">
         <label for="orgID" class="col-md-3 col-form-label">#{msg['organization.organizationId']}:</label>
         <label id="orgID"
                class="col-md-9 col-form-label"><strong>#{organizationBean.organization.organizationId}</strong></label>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" required="#{true}" value="#{msg['organization.name']}"/>
         </div>
         <div class="col-md-9">
          <h:inputText id="organizationName" converterId="trimConverter" maxlength="#{appBean.nameLen}"
                       required="#{organizationBean.currentUser.supplier or organizationBean.currentUser.technologyProvider}"
                       value="#{organizationBean.organization.name}" styleClass="form-control"/>
         </div>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" required="#{true}" value="#{msg['organization.email']}"/>
         </div>
         <div class="col-md-9">
          <h:inputText id="organizationEmail" maxlength="#{appBean.nameLen}" validatorId="email"
                       required="#{organizationBean.currentUser.supplier or organizationBean.currentUser.technologyProvider}"
                       onchange="setDirty(true)" value="#{organizationBean.organization.email}"
                       styleClass="form-control" converterId="trimConverter"/>
         </div>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" required="#{true}" value="#{msg['organization.address']}"/>
         </div>
         <div class="col-md-9">
          <h:inputTextarea id="organizationAddress" converterId="trimConverter" maxlength="#{appBean.descriptionLen}"
                           required="#{organizationBean.currentUser.supplier or organizationBean.currentUser.technologyProvider}"
                           value="#{organizationBean.organization.address}" styleClass="form-control"
                           onchange="setDirty(true)" rows="5"/>
         </div>
        </div>
        <div class="form-row pb-2">
         <div class="col-md-3">
          <adm:outputLabel class="col-form-label" required="#{true}" value="#{msg['common.country']}"/>
         </div>
         <div class="col-md-9">
          <h:selectOneMenu id="country" value="#{organizationBean.organization.domicileCountry}"
                           styleClass="custom-select" required="true">
           <adm:countryItems supportedCountries="#{countryBean.supportedCountryCodesForEditProfilePage}"/>
          </h:selectOneMenu>
         </div>
        </div>
       </div>
       <hr/>
       <adm:buttonPanel layout="block" styleClass="clearfix">
        <adm:buttonBootstrap id="saveOrgButton" value="#{msg['button.save']}" bean="#{organizationBean}" action="save"
                             onclick="validateCurrentUserRoles();return false;"
                             styleClass="btn btn-secondary float-right"/>
       </adm:buttonPanel>
      </h:form>
     </rich:tab>

     <rich:tab id="tabAttr" header="#{msg['marketplace.account.profile.attributeTab']}"
               onheaderclick="setSelectedTab('tabAttr');" rendered="#{userBean.isOrganizationAdmin}">

      <h:form id="attrForm">

       <h2>
        <adm:outputStep value="#{msg['marketplace.account.profile.attributes.title']}"/>
       </h2>

       <a4j:outputPanel id="attributesTablePanel" layout="block"
                        styleClass="tablePanel table_padding minimumSizeTable">

        <c:set var="sortIconAscending" value="/marketplace/img/transparentPixel.png?id=sortAscending"/>
        <c:set var="sortIconDescending" value="/marketplace/img/transparentPixel.png?id=sortDescending"/>

        <rich:dataTable headerClass="rowTitle" rowClasses="rowOdd,rowEven" id="attributesTable" width="100%"
                        rows="10" value="#{manageAttributesCtrl.model.attributes}" var="item" selectionMode="single"
                        enableContextMenu="false" noDataLabel=" " columnClasses="alignTop wrapColumns preWrapping"
                        styleClass="table table-striped table-hover table-bordered sortable" render="pagerPanel"
                        rendered="#{(not empty manageAttributesCtrl.model.attributes)}" sortMode="single">

         <rich:column styleClass="show-service-row col-icon" headerClass="show-service-row">
          <rich:collapsibleSubTableToggler for="sbtbl"/>
         </rich:column>

         <rich:column id="colUdaName" width="#{mediumWidth}" sortBy="#{item.udaNameToShow}" sortIcon="#{sortIcon}"
                      sortIconAscending="#{sortIconAscending}" sortIconDescending="#{sortIconDescending}"
                      sortOrder="#{tableState.sortOrders['mpColUdaName']}"
                      filterType="custom" filterValue="#{tableState.filterValues['colUdaName']}"
                      filterExpression="#{adm:matchBegin(item.udaNameToShow, tableState.filterValues['colUdaName'], false)}">
          <f:facet name="header">
           <h:outputText value="#{msg['marketplace.account.profile.attributes.udaName']}"/>
           <hr class="my-1"/>
           <adm:filterInputBootstrap inputId="filterUdaName" inputValue="#{tableState.filterValues['colUdaName']}"
                                     render="attributesTable@body pagerPanel"
                                     onkeyup="AdmUtils.setFirstPage(#{rich:element('attributePager')});"/>
          </f:facet>
          <h:outputText value="#{item.udaNameToShow}"/>
         </rich:column>

         <rich:column id="colVendor" width="#{mediumWidth}" sortBy="#{item.vendor.name}" sortIcon="#{sortIcon}"
                      sortIconAscending="#{sortIconAscending}" sortIconDescending="#{sortIconDescending}"
                      sortOrder="#{tableState.sortOrders['mpColVendor']}" styleClass="column-service-hide"
                      filterType="custom" filterValue="#{tableState.filterValues['colVendor']}"
                      filterExpression="#{adm:matchBegin(item.vendor.name, tableState.filterValues['colVendor'], false)}"
                      headerClass="column-service-hide">
          <f:facet name="header">
           <h:outputText value="#{msg['marketplace.account.profile.attributes.vendor']}"/>
           <hr class="my-1"/>
           <adm:filterInputBootstrap inputId="filterVendor" inputValue="#{tableState.filterValues['colVendor']}"
                                     render="attributesTable@body pagerPanel"
                                     onkeyup="AdmUtils.setFirstPage(#{rich:element('attributePager')});"/>
          </f:facet>
          <h:outputText value="#{item.vendor.name}"/>
         </rich:column>

         <c:set var="scopeKey" value="UdaConfigurationType.#{item.udaDefinition.configurationType}"/>

         <rich:column width="#{smallWidth}" sortBy="#{item.udaDefinition.configurationType}" sortIcon="#{sortIcon}"
                      sortIconAscending="#{sortIconAscending}" sortIconDescending="#{sortIconDescending}"
                      styleClass="column-unit-hide" headerClass="align-top column-unit-hide">
          <f:facet name="header">
           <h:outputText value="#{msg['marketplace.account.profile.attributes.scope']}"/>
           <hr class="my-1"/>
          </f:facet>
          <h:outputText value="#{msg[scopeKey]}"/>
         </rich:column>

         <rich:column id="colUdaValue" width="#{restWidth}" sortBy="#{item.udaValue}" sortIcon="#{sortIcon}"
                      sortIconAscending="#{sortIconAscending}" sortIconDescending="#{sortIconDescending}"
                      sortOrder="#{tableState.sortOrders['mpColUdaValue']}"
                      filterType="custom" filterValue="#{tableState.filterValues['colUdaValue']}"
                      filterExpression="#{adm:matchBegin(item.udaValueToShow, tableState.filterValues['colUdaValue'], false)}">
          <f:facet name="header">
           <h:outputText value="#{msg['marketplace.account.profile.attributes.value']}"/>
           <hr class="my-1"/>
           <adm:filterInputBootstrap inputId="filterUdaValue" inputValue="#{tableState.filterValues['colUdaValue']}"
                                     render="attributesTable@body pagerPanel"
                                     onkeyup="AdmUtils.setFirstPage(#{rich:element('attributePager')});"/>
          </f:facet>
          <h:inputText id="udaValueClear" onchange="setDirty(true)"  styleCLass="form-control form-check"
                       maxlength="#{appBean.descriptionLen}" required="#{item.inputMandatory}" value="#{item.udaValue}"
                       label="#{item.udaId}" rendered="#{not item.inputEncrypted}">
          </h:inputText>
          <h:inputSecret id="udaValuePassword" onchange="setDirty(true)" value="#{item.passwordValueToStore}"
                         maxlength="#{appBean.descriptionLen}" required="#{item.inputMandatory}" redisplay="true"
                         label="#{item.udaId}" rendered="#{item.inputEncrypted}" styleCLass="form-control form-check">
          </h:inputSecret>

         </rich:column>
         <f:facet name="footer">
          <a4j:outputPanel>
           <adm:pagerBootstrap pagerId="attributePager"/>
          </a4j:outputPanel>
         </f:facet>

         <rich:collapsibleSubTable id="sbtbl" value="#{manageAttributesCtrl.model.attributes}" var="item"
                                   expandMode="client" expanded="#{false}" rows="1">
          <rich:column colspan="4">
           <div class="container">
            <div class="row show-service-row py-1">
             <div class="col-4">#{msg['marketplace.account.profile.attributes.vendor']}:</div>
             <div class="col-8">
              <h:outputText value="#{item.vendor.name}" styleClass="font-weight-bold"/>
             </div>
            </div>
            <div class="row show-unit-row py-1">
             <div class="col-4">#{msg['marketplace.account.profile.attributes.scope']}:</div>
             <div class="col-8">
              <h:outputText value="#{msg[scopeKey]}" styleClass="font-weight-bold"/>
             </div>
            </div>
           </div>
          </rich:column>
         </rich:collapsibleSubTable>

        </rich:dataTable>
       </a4j:outputPanel>

       <br/>
       <hr/>
       <adm:buttonPanel layout="block" styleClass="clearfix">
        <adm:buttonBootstrap id="saveAttrButton" value="#{msg['button.save']}" bean="#{manageAttributesCtrl}"
                             action="saveAttributes" rendered="#{(not empty manageAttributesCtrl.model.attributes)}"
                             styleClass="btn btn-secondary float-right"/>
       </adm:buttonPanel>
      </h:form>

     </rich:tab>
    </rich:tabPanel>

    <h:form>
     <a4j:jsFunction name="setSelectedTab">
      <a4j:param name="param1" assignTo="#{sessionBean.selectedTab}"/>
     </a4j:jsFunction>
    </h:form>

   </div>
   <mp:reloginConfirmPanel/>
  </a4j:outputPanel>

  <link href="#{facesContext.externalContext.requestContextPath}/css/dataTableDarkStyle.css" rel="stylesheet"
        type="text/css" media="all"/>

  <script>
   var $j = jQuery.noConflict();
   $j(document).ready(function(){
    $j('[data-toggle="popover"]').popover({container: 'body'});
   });
  </script>

 </ui:define>
</ui:composition>