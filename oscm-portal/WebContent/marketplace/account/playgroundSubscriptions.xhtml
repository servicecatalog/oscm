<!-- Copyright FUJITSU LIMITED 2020-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:a4j="http://richfaces.org/a4j"
                xmlns:mp="http://www.fujitsu.com/global/services/software/interstage/marketplace"
                template="../templates/mainBootstrap.xhtml">

 <ui:define name="pageId">
  <c:set var="pageId" value="marketplace.account.subscriptions"/>
  <c:set var="dirty" value="false"/>
 </ui:define>

 <ui:define name="breadcrumbs">
  <mp:bootstrapBreadcrumbs>
   <mp:crumb labelPageId="marketplace.account" link="/marketplace/account/index.jsf"/>
   <mp:crumb labelPageId="#{pageId}"/>
  </mp:bootstrapBreadcrumbs>
 </ui:define>

 <ui:define name="aside">
  <mp:bootstrapNavigationMenu bean="#{accountNavigationBean}"/>
 </ui:define>
 <ui:define name="contents">

  <a4j:outputPanel id="all" layout="block">
   <h:form id="subListForm">
    <div class="px-sm-4 pt-sm-4 table_container">
     <mp:outputStepBootstrap id="pageHeader" value="#{msg['subscriptions.table.availableToAdministrate']}"/>
     <table id="table" class="table table-striped table-hover table-bordered" style="width: 100%">
      <thead>
      <tr class="text-center">
       <th id="collapseButton" class="table_column" style="width: 20px"/>
       <th id="edit" class="desktop"/>
       <th id="columnHeaderName" class="all">#{msg['subscriptions.table.name']}</th>
       <th id="columnHeaderReference" class="desktop">#{msg['subscriptions.table.reference']}</th>
       <th id="columnHeaderUnit" class="desktop">#{msg['subscription.unit']}</th>
       <th id="columnHeaderService" class="desktop">#{msg['subscription.service']}</th>
       <th id="columnHeaderActivation" class="min-tablet">#{msg['subscriptions.table.activation']}</th>
       <th id="columnHeaderStatus" class="all">#{msg['subscription.status']}</th>
      </tr>
      </thead>
      <tbody>
      <c:forEach items="#{subscriptionsCtrl.model.getSubscriptionsData()}" var="sub">
       <tr class="text-left">
        <td class="position-absolute table_column"/>
        <td>
         <div class="d-block d-lg-none">
          <h:commandLink
            action="#{subscriptionsCtrl.showSubscriptionDetails(sub.subscriptionId, sub.subscriptionKey)}"
            render=":hiddenErrorPanel subListForm">
           <button id="editSubImage#{sub.subscriptionId}" type="button" class="btn btn-secondary">
            #{msg['subscription.manage.button']}
           </button>
           <f:setPropertyActionListener target="#{subscriptionsCtrl.model.selectedSubscription}"
                                        value="#{subscription}"/>
          </h:commandLink>
         </div>
         <div class="d-none d-lg-block text-center">
          <h:commandLink
            action="#{subscriptionsCtrl.showSubscriptionDetails(sub.subscriptionId, sub.subscriptionKey)}"
            render=":hiddenErrorPanel subListForm">
           <i class="fa fa-pencil-square-o"/>
           <f:setPropertyActionListener target="#{subscriptionsCtrl.model.selectedSubscription}"
                                        value="#{subscription}"/>
          </h:commandLink>
         </div>
        </td>
        <td>#{sub.subscriptionId}</td>
        <td>#{sub.purchaseOrderNumber}</td>
        <td>#{sub.unit}</td>
        <td>#{sub.serviceName}</td>
        <td>
         <h:outputText value="#{sub.activationDate}">
          <f:convertDateTime pattern="#{msg[appBean.dateInputPattern]}"
                             timeZone="#{appBean.timeZoneId}"/>
         </h:outputText>
        </td>
        <td>
         <ui:include src="../subscriptions/status.xhtml">
          <ui:param name="subscription" value="#{sub}"/>
         </ui:include>
        </td>
       </tr>
      </c:forEach>
      </tbody>
      <tfoot>
      <tr>
       <th class="table_column" style="width: 20px"/>
       <th class="desktop"/>
       <th class="all">#{msg['subscriptions.table.name']}</th>
       <th class="desktop">#{msg['subscriptions.table.reference']}</th>
       <th class="desktop">#{msg['subscription.unit']}</th>
       <th class="desktop">#{msg['subscription.service']}</th>
       <th class="min-tablet">#{msg['subscriptions.table.activation']}</th>
       <th class="all">#{msg['subscription.status']}</th>
      </tr>
      </tfoot>
     </table>
    </div>
   </h:form>
  </a4j:outputPanel>

  <ui:include src="subscriptionAdministratePanel.xhtml">
   <ui:param name="dialogId" value="subscriptionAdministratePanel"/>
  </ui:include>

  <mp:linkPageTop/>

  <script type="text/javascript">
$(document).ready(function() {

$('#table tfoot th').each( function () {
        var title = $(this).text();
        if(title !== ""){
        $(this).html( '&lt;input class="form-control form-control-sm" type="text" placeholder="Search '+title+'" />' );
        }
    });

 var table = $('#table').DataTable({
 responsive: true,
  columnDefs: [{
   orderable: false,
   targets: 0
  }, {
   orderable: false,
   targets: 1
  }]
 });

 table.columns().every( function () {
  var that = this;

  $( 'input', this.footer() ).on( 'keyup change clear', function () {
   if ( that.search() !== this.value ) {
     that
       .search( this.value )
       .draw();
     }
   });
  });

  $('#table tfoot tr').appendTo('#table thead');
});
  </script>

  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css"/>
  <link href="#{facesContext.externalContext.requestContextPath}/css/dataTable.css" rel="stylesheet"
        type="text/css" media="all"/>
 </ui:define>
</ui:composition>